# –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≤–∞–ª—é—Ç–µ –≤ —á–∞—Ç

## –†–µ–∑—é–º–µ
–£–¥–∞–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –≤–∞–ª—é—Ç–µ –≤ —á–∞—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –≥–æ—Ä–æ–¥–∞ –º–∞—Å—Ç–µ—Ä–æ–º. –í–∞–ª—é—Ç–∞ **–ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ **—Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ–ª—å—à–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** –≤ —á–∞—Ç.

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
**–ü—É—Ç—å:** `bot/handlers/master/menu.py`

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –§—É–Ω–∫—Ü–∏—è `receive_location()` (—Å—Ç—Ä–æ–∫–∏ 1031-1148)

**–ß—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ:**
- –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≤–∞–ª—é—Ç–µ (—Å—Ç—Ä–æ–∫–∏ 1112-1131 –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ –≤–∞–ª—é—Ç—ã
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥–æ—Ä–æ–¥–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö

**–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:**
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã –ø–æ –∫–æ–¥—É —Å—Ç—Ä–∞–Ω—ã  
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã –≤ –ë–î
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ fallback –Ω–∞ RUB

**–ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
```python
# –í–º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≤–∞–ª—é—Ç–µ:
# –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:
await update.message.reply_text(
    "‚úÖ –ì–æ—Ä–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!",
    parse_mode='HTML',
    reply_markup=ReplyKeyboardRemove()
)
```

**–ö–æ–¥ –≤–∞–ª—é—Ç—ã –æ—Å—Ç–∞–µ—Ç—Å—è:**
```python
# –í—Å–µ —ç—Ç–æ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î:
master.currency = currency
session.commit()
```

### 2. –§—É–Ω–∫—Ü–∏—è `select_city_from_search()` (—Å—Ç—Ä–æ–∫–∏ 738-879)

**–ß—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ:**
- –ö–æ–¥ —Å `get_currency_symbol()` –∏–º–ø–æ—Ä—Ç–æ–º
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤–∞–ª—é—Ç–µ (12 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `üí∞ –í–∞–ª—é—Ç–∞: RUB ‚ÇΩ`

**–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:**
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã –ø–æ –∫–æ–¥—É —Å—Ç—Ä–∞–Ω—ã
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã –≤ –ë–î
- ‚úÖ –í—Å—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ—Ä–æ–¥–∞

**–ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
```python
# –í–º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤–∞–ª—é—Ç–æ–π:
# –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:
await query.message.edit_text(
    "‚úÖ –ì–æ—Ä–æ–¥ –≤—ã–±—Ä–∞–Ω!",
    parse_mode='HTML'
)
```

**–°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:**
```python
# –ë—ã–ª–æ: "‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞: –ú–æ—Å–∫–≤–∞\n\n–û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞–ª—é—Ç—É..."
# –°—Ç–∞–ª–æ: "‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º..."
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –ù–ï –∏–∑–º–µ–Ω–∏–ª—Å—è

‚úÖ **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã**
- –°–∏—Å—Ç–µ–º–∞ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∞–ª—é—Ç—É –ø–æ –∫–æ–¥—É —Å—Ç—Ä–∞–Ω—ã
- –°–∏—Å—Ç–µ–º–∞ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∫–µ—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ë–î
- System –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç REST Countries API –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω

‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã**
- `master.currency` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–µ–Ω —É—Å–ª—É–≥ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω —á–µ—Ä–µ–∑ `format_price()`

‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- –¢–∞–π–º–∞—É—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (30 —Å–µ–∫)
- Fallback –Ω–∞ RUB –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–æ –≤—Ä–µ–º—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã

‚úÖ **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
- –ü—Ä–∏–≤—è–∑–∫–∞ –≥–æ—Ä–æ–¥–∞ –∫ –º–∞—Å—Ç–µ—Ä-–∞–∫–∫–∞—É–Ω—Ç—É
- –ü–æ–∫–∞–∑ –∞–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –∏–ª–∏ –º–µ–Ω—é –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞

## –õ–æ–≥–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞

### –ò–∑ `receive_location()`
```python
# –£–î–ê–õ–ï–ù–û: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤–∞–ª—é—Ç–µ
from bot.utils.currency import get_currency_symbol
currency_symbol = get_currency_symbol(master.currency)

text = f"‚úÖ –ì–æ—Ä–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω: <b>{city.name_ru}</b>\n\n"
text += f"üá∑üá∫ {city.name_ru}\n"
text += f"üåç {city.name_local}\n"
text += f"üá¨üáß {city.name_en}\n"
text += f"üí∞ –í–∞–ª—é—Ç–∞: <b>{master.currency} {currency_symbol}</b>\n\n"
text += "–¢–µ–ø–µ—Ä—å –∫–ª–∏–µ–Ω—Ç—ã —Å–º–æ–≥—É—Ç –Ω–∞–π—Ç–∏ –≤–∞—Å –ø–æ –≥–æ—Ä–æ–¥—É!"

await update.message.reply_text(
    text,
    parse_mode='HTML',
    reply_markup=ReplyKeyboardRemove()
)
```

### –ò–∑ `select_city_from_search()`
```python
# –£–î–ê–õ–ï–ù–û: –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≤–∞–ª—é—Ç–µ
from bot.utils.currency import get_currency_symbol
currency_symbol = get_currency_symbol(master.currency)

text = f"‚úÖ <b>–ì–æ—Ä–æ–¥ –≤—ã–±—Ä–∞–Ω!</b>\n\n"
text += f"üìç <b>{city.name_ru}</b>\n"
if city.country_code:
    text += f"üåç {city.name_local}\n"
    text += f"üá¨üáß {city.name_en}\n"
text += f"üí∞ –í–∞–ª—é—Ç–∞: <b>{master.currency} {currency_symbol}</b>\n\n"
text += f"–¢–µ–ø–µ—Ä—å –∫–ª–∏–µ–Ω—Ç—ã —Å–º–æ–≥—É—Ç –Ω–∞–π—Ç–∏ –≤–∞—Å –ø–æ –≥–æ—Ä–æ–¥—É!"

await query.message.edit_text(
    text,
    parse_mode='HTML'
)
```

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –ü–û–°–õ–ï –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        ‚Üì
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (get_city_from_location)
        ‚Üì
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã (get_currency_by_country_async)
        ‚îú‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞
        ‚îú‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
        ‚îî‚Üí –ó–∞–ø—Ä–æ—Å –∫ REST Countries API
        ‚Üì
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î: master.currency = currency
        ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: "‚úÖ –ì–æ—Ä–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!"
        ‚Üì
–ü–æ–∫–∞–∑ –∞–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –∏–ª–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ "‚úÖ –ì–æ—Ä–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!"
2. **–í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥ –≤—Ä—É—á–Ω—É—é** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∏–¥–Ω–æ "‚úÖ –ì–æ—Ä–æ–¥ –≤—ã–±—Ä–∞–Ω!"
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `master.currency` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–Ω—ã —É—Å–ª—É–≥** - –≤–∞–ª—é—Ç–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ –º–∞—Å—Ç–µ—Ä–∞ –∏ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —É—Å–ª—É–≥ –∫–ª–∏–µ–Ω—Ç–æ–º

## –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–§–∞–π–ª –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ Python:
```
python -m py_compile bot/handlers/master/menu.py
# ‚úÖ –û—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
```

## –û—Ç–∫–∞—Ç

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≤–∞–ª—é—Ç–µ, –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–π –∫–æ–¥ –∏–∑ git:
```bash
git diff bot/handlers/master/menu.py
# –ü–æ–∫–∞–∂–µ—Ç —á—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

- ‚úÖ –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≤–∞–ª—é—Ç–µ —É–¥–∞–ª–µ–Ω–∞
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ —Å–ª–æ–º–∞–Ω - –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω, –æ—à–∏–±–æ–∫ –Ω–µ—Ç
