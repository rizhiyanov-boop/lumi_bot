# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Lumi Beauty

## –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
Lumi/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py       # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.py           # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ master.py       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–∞—Å—Ç–µ—Ä-–±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ client.py       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç-–±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ main_master.py      # Entry point –º–∞—Å—Ç–µ—Ä-–±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ main_client.py      # Entry point –∫–ª–∏–µ–Ω—Ç-–±–æ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ run_master.py           # –ó–∞–ø—É—Å–∫ –º–∞—Å—Ç–µ—Ä-–±–æ—Ç–∞
‚îú‚îÄ‚îÄ run_client.py           # –ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç-–±–æ—Ç–∞
‚îî‚îÄ‚îÄ database.db             # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

## –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### MasterAccount
–ê–∫–∫–∞—É–Ω—Ç –º–∞—Å—Ç–µ—Ä–∞:
- `telegram_id` - Telegram ID –º–∞—Å—Ç–µ—Ä–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `name` - –ò–º—è –º–∞—Å—Ç–µ—Ä–∞
- `description` - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `avatar_url` - –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä –∏–∑ Telegram
- `extra_masters_json` - JSON –¥–ª—è –º—É–ª—å—Ç–∏-–º–∞—Å—Ç–µ—Ä–∞ (—Ä–µ–∑–µ—Ä–≤ –Ω–∞ –±—É–¥—É—â–µ–µ)

### ServiceCategory
–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥:
- `master_account_id` - ID –∞–∫–∫–∞—É–Ω—Ç–∞ –º–∞—Å—Ç–µ—Ä–∞
- `title` - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### Service
–£—Å–ª—É–≥–∞:
- `master_account_id` - ID –∞–∫–∫–∞—É–Ω—Ç–∞ –º–∞—Å—Ç–µ—Ä–∞
- `category_id` - ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `title` - –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏
- `description` - –û–ø–∏—Å–∞–Ω–∏–µ
- `price` - –¶–µ–Ω–∞
- `duration_mins` - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–Ω—É—Ç–∞—Ö
- `cooling_period_mins` - –ü–µ—Ä–∏–æ–¥ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è (–≤—Ä–µ–º—è –º–µ–∂–¥—É –∑–∞–ø–∏—Å—è–º–∏)
- `active` - –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ —É—Å–ª—É–≥–∞

### WorkPeriod
–†–∞–±–æ—á–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª:
- `master_account_id` - ID –∞–∫–∫–∞—É–Ω—Ç–∞ –º–∞—Å—Ç–µ—Ä–∞
- `weekday` - –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (0=–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 6=–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
- `start_time` - –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ (HH:MM)
- `end_time` - –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è (HH:MM)

### User
–ö–ª–∏–µ–Ω—Ç:
- `telegram_id` - Telegram ID –∫–ª–∏–µ–Ω—Ç–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)

### UserMaster
–°–≤—è–∑—å –∫–ª–∏–µ–Ω—Ç ‚Üî –º–∞—Å—Ç–µ—Ä:
- `user_id` - ID –∫–ª–∏–µ–Ω—Ç–∞
- `master_account_id` - ID –º–∞—Å—Ç–µ—Ä–∞
- –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –¥–∏–ø–ª–∏–Ω–∫—É, —É–¥–∞–ª—è–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–æ–º

### Booking
–ó–∞–ø–∏—Å—å/–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
- `user_id` - ID –∫–ª–∏–µ–Ω—Ç–∞
- `master_account_id` - ID –º–∞—Å—Ç–µ—Ä–∞
- `service_id` - ID —É—Å–ª—É–≥–∏
- `start_dt` - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
- `end_dt` - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
- `price` - –°—Ç–æ–∏–º–æ—Å—Ç—å
- `comment` - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

## –§–ª–æ—É —Ä–∞–±–æ—Ç—ã

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–∞
1. –ú–∞—Å—Ç–µ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç `/start` –≤ –º–∞—Å—Ç–µ—Ä-–±–æ—Ç–µ
2. –°–æ–∑–¥–∞–µ—Ç—Å—è `MasterAccount` —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Telegram
3. –ú–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å, —É—Å–ª—É–≥–∏, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–∏–ø–ª–∏–Ω–∫ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–æ–º
1. –ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ `https://t.me/client_bot?start=master_TELEGRAM_ID`
2. –°–æ–∑–¥–∞–µ—Ç—Å—è `User` (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
3. –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–≤—è–∑—å `UserMaster`
4. –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –º–∞—Å—Ç–µ—Ä–∞ –≤ —Å–≤–æ–µ–º —Å–ø–∏—Å–∫–µ

### –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏
1. –ö–ª–∏–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –º–∞—Å—Ç–µ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
2. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —É—Å–ª—É–≥–∏ (–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)
3. –í—ã–±–∏—Ä–∞–µ—Ç —É—Å–ª—É–≥—É
4. –í—ã–±–∏—Ä–∞–µ—Ç –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è (—Å —É—á–µ—Ç–æ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ cooling period)
5. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å
6. –°–æ–∑–¥–∞–µ—Ç—Å—è `Booking`
7. –ú–∞—Å—Ç–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –£–¥–∞–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –º–∞—Å—Ç–µ—Ä–∞
2. –ù–∞–∂–∏–º–∞–µ—Ç "–£–¥–∞–ª–∏—Ç—å –º–∞—Å—Ç–µ—Ä–∞"
3. –£–¥–∞–ª—è–µ—Ç—Å—è —Å–≤—è–∑—å `UserMaster`
4. –ú–∞—Å—Ç–µ—Ä –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### Deep Linking
–§–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:
```
https://t.me/YOUR_CLIENT_BOT?start=master_<TELEGRAM_ID>
```

–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ:
- `context.args[0]` —Å–æ–¥–µ—Ä–∂–∏—Ç `"master_<TELEGRAM_ID>"`
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è Telegram ID –º–∞—Å—Ç–µ—Ä–∞
- –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–≤—è–∑—å –∫–ª–∏–µ–Ω—Ç-–º–∞—Å—Ç–µ—Ä

### Cooling Period
–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —É—Å–ª—É–≥–∏:
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –æ–¥–Ω—É —É—Å–ª—É–≥—É
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –º–∏–Ω—É—Ç–∞—Ö
- –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

### –ú—É–ª—å—Ç–∏-–º–∞—Å—Ç–µ—Ä (—Ä–µ–∑–µ—Ä–≤)
–ü–æ–ª–µ `extra_masters_json` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤ –±—É–¥—É—â–µ–º:
- –î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä–æ–≤ –ø–æ–¥ –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç (–º–∏–∫—Ä–æ—Å–∞–ª–æ–Ω)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞–ø–∏—Å–∏ –º–µ–∂–¥—É –º–∞—Å—Ç–µ—Ä–∞–º–∏
- –í–µ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É

### Telegram ID –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á
–í—Å–µ —Å–≤—è–∑–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ Telegram ID:
- –ù–µ –Ω—É–∂–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –ø–∞—Ä–æ–ª–µ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram

## –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### –ß—Ç–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **–ü–ª–∞—Ç–µ–∂–∏**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Payments
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `paid` –≤ `Booking`
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ–∫–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

2. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**
   - JobQueue –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ N —á–∞—Å–æ–≤ –¥–æ –∑–∞–ø–∏—Å–∏
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å

3. **–†–µ–π—Ç–∏–Ω–≥–∏ –∏ –æ—Ç–∑—ã–≤—ã**
   - –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `Review`
   - –°–≤—è–∑—å —Å `MasterAccount` –∏ `User`
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–∫–∏

4. **–§–æ—Ç–æ —É—Å–ª—É–≥**
   - –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `ServiceImage`
   - –•—Ä–∞–Ω–µ–Ω–∏–µ file_id –∏–∑ Telegram
   - –ì–∞–ª–µ—Ä–µ—è –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —É—Å–ª—É–≥–∏

5. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏
   - –î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü/–Ω–µ–¥–µ–ª—é

6. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   - –ú–∞—Å—Ç–µ—Ä—É –æ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ (—É–∂–µ –µ—Å—Ç—å –±–∞–∑–æ–≤–æ)
   - –ö–ª–∏–µ–Ω—Ç—É –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –º–∞—Å—Ç–µ—Ä–æ–≤
- ‚úÖ –ú–∞—Å—Ç–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏
- ‚úÖ Telegram ID –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection —á–µ—Ä–µ–∑ ORM
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤–≤–æ–¥–æ–≤

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- SQLite –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
- –õ–µ–≥–∫–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ PostgreSQL –¥–ª—è production
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤—Å–µ—Ö foreign keys
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ Telegram (inline keyboards)

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é! üöÄ**

