# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º +6 —á–∞—Å–æ–≤

## üêõ –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ 12:00 –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –∏–∑-–∑–∞ –∂–µ—Å—Ç–∫–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ –∫–æ–¥–µ, —á—Ç–æ –∫–∞–∂–¥–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –¥–ª–∏—Ç—å—Å—è 6 —á–∞—Å–æ–≤.

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:
```
–†–∞–±–æ—á–∏–π –¥–µ–Ω—å: 09:00 - 21:00
–°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞: –∫–∞–∂–¥–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ = –Ω–∞—á–∞–ª–æ + 6 —á–∞—Å–æ–≤

–°–ª–æ—Ç 12:00: 12:00 + 6 —á–∞—Å–æ–≤ = 18:00 ‚úÖ OK
–°–ª–æ—Ç 15:00: 15:00 + 6 —á–∞—Å–æ–≤ = 21:00 ‚úÖ OK  
–°–ª–æ—Ç 16:00: 16:00 + 6 —á–∞—Å–æ–≤ = 22:00 ‚ùå –ó–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è
–°–ª–æ—Ç 17:00: 17:00 + 6 —á–∞—Å–æ–≤ = 23:00 ‚ùå –ó–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è

‚Üí –°–ª–æ—Ç—ã –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –±—ã–ª–∏ —Å–∫—Ä—ã—Ç—ã
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `bot/keyboards/inline.py` (—Ñ—É–Ω–∫—Ü–∏—è `get_time_keyboard`)

**–î–æ:**
```python
# –ö–æ–Ω–µ—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–æ—Ç–∞ (6 —á–∞—Å–æ–≤, –Ω–æ –Ω–µ –ø–æ–∑–∂–µ 23:00)
end_hour = min(hour + 6, 23)
end_time = time(end_hour, 0)
```

**–ü–æ—Å–ª–µ:**
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω–µ—Ü —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö 6 —á–∞—Å–æ–≤
work_end_time = parse_work_time(WORK_END)
end_time = work_end_time

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã 1 —á–∞—Å –¥–æ –∫–æ–Ω—Ü–∞
min_booking_time = time(hour + 1, 0)
if min_booking_time > effective_end_time:
    continue  # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏
```

**–ò–∑–º–µ–Ω–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:**
```python
# –î–æ: –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –≤—Å–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–Ω–∞—á–∞–ª–æ + 6 —á–∞—Å–æ–≤)
if (start_time < booked_end and end_time > booked_start):
    is_available = False

# –ü–æ—Å–ª–µ: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ —Å–ª–æ—Ç–∞
if booked_start <= start_time < booked_end:
    is_available = False
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `bot/handlers/booking.py` (—Ñ—É–Ω–∫—Ü–∏—è `confirm_booking`)

**–î–æ:**
```python
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º end_time –Ω–∞ 6 —á–∞—Å–æ–≤ –ø–æ–∑–∂–µ
end_hour = min(start_hour + 6, 23)
end_time = time(end_hour, 0)
duration_hours = 6  # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

**–ü–æ—Å–ª–µ:**
```python
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º end_time –Ω–∞ –∫–æ–Ω–µ—Ü —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è
work_end_time = parse_work_time(WORK_END)
end_time = work_end_time

# –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ –∫–æ–Ω—Ü–∞ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è
duration_hours = work_end_time.hour - start_hour
if work_end_time.minute > 0:
    duration_hours += 1
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã –í–°–ï —Å–ª–æ—Ç—ã –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è:

```
–†–∞–±–æ—á–∏–π –¥–µ–Ω—å: 09:00 - 21:00

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã (–±–µ–∑ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π):
‚úÖ 09:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (12 —á–∞—Å–æ–≤)
‚úÖ 10:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (11 —á–∞—Å–æ–≤)
‚úÖ 11:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (10 —á–∞—Å–æ–≤)
‚úÖ 12:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (9 —á–∞—Å–æ–≤)
‚úÖ 13:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (8 —á–∞—Å–æ–≤)
‚úÖ 14:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (7 —á–∞—Å–æ–≤)
‚úÖ 15:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (6 —á–∞—Å–æ–≤)
‚úÖ 16:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (5 —á–∞—Å–æ–≤)
‚úÖ 17:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (4 —á–∞—Å–∞)
‚úÖ 18:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (3 —á–∞—Å–∞)
‚úÖ 19:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (2 —á–∞—Å–∞)
‚úÖ 20:00 - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 21:00 (1 —á–∞—Å)
```

### –õ–æ–≥–∏–∫–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏:

```
–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
- 10:00 - 13:00
- 15:00 - 18:00

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã:
‚úÖ 09:00 (–Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è)
‚ùå 10:00 (–∑–∞–Ω—è—Ç–æ)
‚ùå 11:00 (–∑–∞–Ω—è—Ç–æ)
‚ùå 12:00 (–∑–∞–Ω—è—Ç–æ)
‚úÖ 13:00 (—Å–≤–æ–±–æ–¥–Ω–æ)
‚úÖ 14:00 (—Å–≤–æ–±–æ–¥–Ω–æ)
‚ùå 15:00 (–∑–∞–Ω—è—Ç–æ)
‚ùå 16:00 (–∑–∞–Ω—è—Ç–æ)
‚ùå 17:00 (–∑–∞–Ω—è—Ç–æ)
‚úÖ 18:00 (—Å–≤–æ–±–æ–¥–Ω–æ)
‚úÖ 19:00 (—Å–≤–æ–±–æ–¥–Ω–æ)
‚úÖ 20:00 (—Å–≤–æ–±–æ–¥–Ω–æ)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—É—Å—Ç–æ–π –¥–µ–Ω—å (–±–µ–∑ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π)
```bash
python test_time_slots.py
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ 12 —Å–ª–æ—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã (09:00 - 20:00)

### –¢–µ—Å—Ç 2: –î–µ–Ω—å —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
```bash
python test_with_bookings.py
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. `bot/keyboards/inline.py` - —Ñ—É–Ω–∫—Ü–∏—è `get_time_keyboard()`
2. `bot/handlers/booking.py` - —Ñ—É–Ω–∫—Ü–∏—è `confirm_booking()`

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –£—á–µ—Ç –∑–∞–∫–∞—Ç–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫:
```python
# –î–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫: –µ—Å–ª–∏ –∑–∞–∫–∞—Ç —Ä–∞–Ω—å—à–µ –∫–æ–Ω—Ü–∞ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è
if is_outdoor and sunset_time and sunset_time < end_time:
    effective_end_time = sunset_time
```

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã 1 —á–∞—Å –¥–æ –∫–æ–Ω—Ü–∞
min_booking_time = time(hour + 1, 0)
if min_booking_time > effective_end_time:
    continue  # –°–ª–æ—Ç –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
```

## ‚úÖ –†–µ–∑—é–º–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ñ–µ—Å—Ç–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ +6 —á–∞—Å–æ–≤ —Å–∫—Ä—ã–≤–∞–ª–æ —Å–ª–æ—Ç—ã –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–µ—Ü —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è (`WORK_END`) –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö 6 —á–∞—Å–æ–≤  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Å–ª–æ—Ç—ã –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è  

---

*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 27 –æ–∫—Ç—è–±—Ä—è 2025*


